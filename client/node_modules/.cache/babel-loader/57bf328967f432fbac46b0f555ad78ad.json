{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\defineProperty.js\";import _objectSpread from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _asyncToGenerator from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState,useContext,useEffect}from'react';import axios from'axios';import{GlobalState}from'../../../GlobalState';import Loading from'../utils/loading/Loading';import{useNavigate,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";axios.defaults.withCredentials=true;var initialState={product_id:\"\",title:\"\",price:0,description:\"\",content:\"\",category:\"\",_id:\"\"};function Createproduct(){var state=useContext(GlobalState);var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),product=_useState2[0],setProduct=_useState2[1];var _state$CategoriesAPI$=_slicedToArray(state.CategoriesAPI.categories,1),categories=_state$CategoriesAPI$[0];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),images=_useState4[0],setImages=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _state$UserAPI$isAdmi=_slicedToArray(state.UserAPI.isAdmin,1),isAdmin=_state$UserAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var navigate=useNavigate();var param=useParams();var _state$ProductsAPI$pr=_slicedToArray(state.ProductsAPI.products,1),products=_state$ProductsAPI$pr[0];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),onEdit=_useState8[0],setOnEdit=_useState8[1];var _state$ProductsAPI$ca=_slicedToArray(state.ProductsAPI.callback,2),callback=_state$ProductsAPI$ca[0],setCallback=_state$ProductsAPI$ca[1];useEffect(function(){if(param.id){setOnEdit(true);products.forEach(function(product){if(product._id===param.id){setProduct(product);setImages(product.images);}});}else{setOnEdit(false);setProduct(initialState);setImages(false);}},[param.id,products]);var handleUpload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;if(isAdmin){_context.next=4;break;}return _context.abrupt(\"return\",alert(\"Debes ser administrador\"));case 4:file=e.target.files[0];if(file){_context.next=7;break;}return _context.abrupt(\"return\",alert(\"Archivo no existe\"));case 7:if(!(file.size>1024*1024)){_context.next=9;break;}return _context.abrupt(\"return\",alert(\"Archivo demasiado grande! no debe ser mayor a 1MB\"));case 9:if(!(file.type!==\"image/jpeg\"&&file.type!==\"image/png\")){_context.next=11;break;}return _context.abrupt(\"return\",alert(\"Formato de archivo incorrecto, debe ser JPG o PNG\"));case 11:formData=new FormData();formData.append(\"file\",file);setLoading(true);_context.next=16;return axios.post(\"/api/upload\",formData,{headers:{\"content-type\":\"multipart/form-data\",Authorization:token}});case 16:res=_context.sent;setLoading(false);setImages(res.data);_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](1);alert(_context.t0.response.data.msg);case 24:case\"end\":return _context.stop();}}},_callee,null,[[1,21]]);}));return function handleUpload(_x){return _ref.apply(this,arguments);};}();var handleDestroy=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);_context2.next=4;return axios.post(\"/api/destroy\",{public_id:images.public_id},{headers:{Authorization:token}});case 4:setLoading(false);setImages(false);_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);alert(_context2.t0.response.data.msg);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function handleDestroy(){return _ref2.apply(this,arguments);};}();var handleChangeInput=function handleChangeInput(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setProduct(_objectSpread(_objectSpread({},product),{},_defineProperty({},name,value)));};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.prev=1;if(isAdmin){_context3.next=4;break;}return _context3.abrupt(\"return\",alert(\"Debes ser Administrador!\"));case 4:if(images){_context3.next=6;break;}return _context3.abrupt(\"return\",alert(\"Sin imagenes\"));case 6:if(!onEdit){_context3.next=11;break;}_context3.next=9;return axios.put(\"/api/products/\".concat(product._id),_objectSpread(_objectSpread({},product),{},{images:images}),{headers:{Authorization:token}});case 9:_context3.next=13;break;case 11:_context3.next=13;return axios.post(\"/api/products\",_objectSpread(_objectSpread({},product),{},{images:images}),{headers:{Authorization:token}});case 13:setCallback(!callback);navigate({pathname:\"/\"});_context3.next=20;break;case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](1);alert(_context3.t0.response.data.msg);case 20:case\"end\":return _context3.stop();}}},_callee3,null,[[1,17]]);}));return function handleSubmit(_x2){return _ref3.apply(this,arguments);};}();var styleUpload={display:images?\"block\":\"none\"};return/*#__PURE__*/_jsxs(\"div\",{className:\"create_product\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"upload\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",id:\"file_up\",onChange:handleUpload}),/*#__PURE__*/_jsx(\"br\",{}),\" \",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"p\",{children:\"Subir imagenes para el producto (max 1MB, formato jpg/png)\"}),loading?/*#__PURE__*/_jsx(\"div\",{id:\"file_img\",children:/*#__PURE__*/_jsx(Loading,{})}):/*#__PURE__*/_jsxs(\"div\",{id:\"file_img\",style:styleUpload,children:[/*#__PURE__*/_jsx(\"span\",{onClick:handleDestroy,children:\" X \"}),/*#__PURE__*/_jsx(\"img\",{src:images?images.url:\"\",alt:\"\"})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"p\",{children:\"FORMULARIO - PRODUCTO\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"product_id\",children:\"ID DEL PRODUCTO\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"product_id\",id:\"product_id\",required:true,value:product.product_id,onChange:handleChangeInput})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"TITULO\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",id:\"title\",required:true,value:product.title,onChange:handleChangeInput})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"price\",children:\"PRECIO\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"price\",id:\"price\",required:true,value:product.price,onChange:handleChangeInput})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",children:\"DESCRIPCION\"}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",name:\"description\",id:\"description\",required:true,value:product.description,rows:5,onChange:handleChangeInput})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"content\",children:\"DETALLES\"}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",name:\"content\",id:\"content\",required:true,value:product.content,rows:5,onChange:handleChangeInput})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"categories\",children:\"CATEGORIAS  \"}),/*#__PURE__*/_jsxs(\"select\",{name:\"category\",value:product.category,onChange:handleChangeInput,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\" FAVOR SELECCIONAR UNA CATEGORIA \"}),categories.map(function(category){return/*#__PURE__*/_jsx(\"option\",{value:category._id,children:category.name},category._id);})]})]}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",children:[onEdit?\"Actualizar\":\"Crear Producto\",\" \"]})]})]});}export default Createproduct;","map":{"version":3,"sources":["C:/Users/Fabian FF/Desktop/envio/sportShop/client/src/components/mainpages/createProduct/Createproduct.js"],"names":["React","useState","useContext","useEffect","axios","GlobalState","Loading","useNavigate","useParams","defaults","withCredentials","initialState","product_id","title","price","description","content","category","_id","Createproduct","state","product","setProduct","CategoriesAPI","categories","images","setImages","loading","setLoading","UserAPI","isAdmin","token","navigate","param","ProductsAPI","products","onEdit","setOnEdit","callback","setCallback","id","forEach","handleUpload","e","preventDefault","alert","file","target","files","size","type","formData","FormData","append","post","headers","Authorization","res","data","response","msg","handleDestroy","public_id","handleChangeInput","name","value","handleSubmit","put","pathname","styleUpload","display","url","map"],"mappings":"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","sourcesContent":["import React,{useState, useContext, useEffect} from 'react';\nimport axios from 'axios';\nimport {GlobalState} from '../../../GlobalState';\nimport Loading from '../utils/loading/Loading';\nimport {useNavigate, useParams} from 'react-router-dom';\n\n\naxios.defaults.withCredentials = true\n\nconst initialState = {\n    product_id: \"\",\n    title: \"\",\n    price: 0,\n    description: \"\",\n    content: \"\",\n    category: \"\",\n    _id:\"\",\n}\n\nfunction Createproduct() {\n\n    const state = useContext(GlobalState)\n    const [product, setProduct] = useState(initialState)\n    const [categories] = state.CategoriesAPI.categories\n    const [images, setImages] = useState(false)\n    const [loading, setLoading] = useState(false)\n    const [isAdmin]= state.UserAPI.isAdmin\n    const [token]= state.token\n\n\n    const navigate = useNavigate()\n    const param = useParams()\n\n\n    const [products]= state.ProductsAPI.products\n    const [onEdit, setOnEdit] = useState(false)\n    const [callback, setCallback] = state.ProductsAPI.callback\n\n    useEffect(()=>{\n        if(param.id){\n            setOnEdit(true)\n\n            products.forEach(product=>{\n                if(product._id === param.id) {\n                    setProduct(product)\n                    setImages(product.images)\n                }\n            })\n        }else{\n            setOnEdit(false)\n            setProduct(initialState)\n            setImages(false)\n        }\n    },[param.id,products])\n\n    const handleUpload = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"Debes ser administrador\")\n            const file  = e.target.files[0]\n            if(!file) return alert(\"Archivo no existe\")\n            if(file.size > 1024 *1024)//1mb\n            return alert(\"Archivo demasiado grande! no debe ser mayor a 1MB\")\n            if(file.type !== \"image/jpeg\" && file.type !== \"image/png\")//1mb\n                return alert(\"Formato de archivo incorrecto, debe ser JPG o PNG\")\n\n\n            let formData = new FormData()\n            formData.append(\"file\", file)   \n            \n            setLoading(true)\n\n            const res = await axios.post(\"/api/upload\", formData, {\n                headers: {\"content-type\": \"multipart/form-data\", Authorization:token}\n            })\n            setLoading(false)\n            setImages(res.data);\n\n\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n\n    }\n    const handleDestroy = async () =>{\n        try {   \n            setLoading(true)\n            await axios.post(\"/api/destroy\",{public_id: images.public_id},{\n                headers: {Authorization: token}\n            })\n            setLoading(false)\n            setImages(false)\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n    const handleChangeInput = e =>{\n        const {name, value} = e.target\n        setProduct({...product, [name]:value})\n    }\n    const handleSubmit = async e =>{\n        e.preventDefault()\n        try {\n            if(!isAdmin) return alert(\"Debes ser Administrador!\")\n            if(!images) return alert(\"Sin imagenes\")\n            if(onEdit) {\n                await axios.put(`/api/products/${product._id}`, {...product, images},{\n                    headers: {Authorization: token}\n                })\n            }else{\n                await axios.post(\"/api/products\", {...product, images},{\n                    headers: {Authorization: token}\n                })\n            }\n            \n            setCallback(!callback)\n            navigate({pathname:\"/\"})\n        } catch (err) {\n            alert(err.response.data.msg)\n        }\n    }\n\n  \n    \n    const styleUpload = {\n        display: images ? \"block\" : \"none\"\n    }\n\n    return (\n        <div className='create_product'>\n    \n            <div className=\"upload\">\n             \n                <input type=\"file\" name=\"file\" id=\"file_up\" onChange={handleUpload} />\n                <br /> <br />\n                <p>Subir imagenes para el producto (max 1MB, formato jpg/png)</p>\n                {\n                    loading \n                    ? <div id=\"file_img\"><Loading/></div>\n                    :<div id=\"file_img\" style={styleUpload}>\n                        { <span onClick={handleDestroy}> X </span> }\n                        <img src={images ? images.url : \"\"} alt=\"\" />\n                     \n                    </div>\n                    \n                }\n                  \n            </div>\n           \n            <form onSubmit={handleSubmit}>\n            <p>FORMULARIO - PRODUCTO</p>\n                <div className=\"row\">\n                    <label htmlFor=\"product_id\">ID DEL PRODUCTO</label>\n                    <input \n                    type=\"text\" \n                    name=\"product_id\" \n                    id=\"product_id\" \n                    required\n                    value={product.product_id}\n                    onChange={handleChangeInput}\n                    />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"title\">TITULO</label>\n                    <input \n                    type=\"text\" \n                    name=\"title\" \n                    id=\"title\" \n                    required\n                    value={product.title}\n                    onChange={handleChangeInput}\n\n                    />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"price\">PRECIO</label>\n                    <input \n                    type=\"number\" \n                    name=\"price\" \n                    id=\"price\" \n                    required\n                    value={product.price}\n                    onChange={handleChangeInput}\n                    />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"description\">DESCRIPCION</label>\n                    <textarea \n                    type=\"text\" \n                    name=\"description\" \n                    id=\"description\" \n                    required\n                    value={product.description}\n                    rows={5}\n                    onChange={handleChangeInput}\n                    />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"content\">DETALLES</label>\n                    <textarea \n                    type=\"text\" \n                    name=\"content\" \n                    id=\"content\" \n                    required\n                    value={product.content}\n                    rows={5}\n                    onChange={handleChangeInput}\n                    />\n                </div>\n                <div className=\"row\">\n                    <label htmlFor=\"categories\">CATEGORIAS  </label>\n                    <select name=\"category\" value={product.category} onChange={handleChangeInput}>\n                        <option value=\"\"> FAVOR SELECCIONAR UNA CATEGORIA </option>\n                        {\n                            categories.map(category=>(\n                                <option value={category._id} key={category._id}>\n                                    {category.name}\n                                </option>\n                            ))\n                        }\n                    </select>\n                </div>\n                <button type='submit'>{ onEdit ? \"Actualizar\" : \"Crear Producto\" } </button>\n            </form>\n        </div>\n    )\n}\n\nexport default Createproduct;\n"]},"metadata":{},"sourceType":"module"}