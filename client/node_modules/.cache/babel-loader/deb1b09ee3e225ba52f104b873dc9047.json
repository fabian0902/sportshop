{"ast":null,"code":"import _asyncToGenerator from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _toConsumableArray from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\toConsumableArray.js\";import _slicedToArray from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\Fabian FF\\\\Desktop\\\\envio\\\\sportShop\\\\client\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useContext,useState}from'react';import{GlobalState}from'../../../GlobalState';import ProductItem from'../utils/productItem/ProductItem';import Loading from\"../utils/loading/Loading\";import axios from'axios';import Filters from'./Filters';import LoadMore from'./LoadMore';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";axios.defaults.withCredentials=true;function Products(){var state=useContext(GlobalState);var _state$ProductsAPI$pr=_slicedToArray(state.ProductsAPI.products,2),products=_state$ProductsAPI$pr[0],setProducts=_state$ProductsAPI$pr[1];var _state$UserAPI$isAdmi=_slicedToArray(state.UserAPI.isAdmin,1),isAdmin=_state$UserAPI$isAdmi[0];var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var _state$ProductsAPI$ca=_slicedToArray(state.ProductsAPI.callback,2),callback=_state$ProductsAPI$ca[0],setCallback=_state$ProductsAPI$ca[1];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isCheck=_useState4[0],setIsCheck=_useState4[1];var handleCheck=function handleCheck(id){products.forEach(function(product){if(product._id===id)product.checked=!product.checked;});setProducts(_toConsumableArray(products));};var deleteProduct=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id,public_id){var destroyImg,_deleteProduct;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);destroyImg=axios.post(\"/api/destroy\",{public_id:public_id},{headers:{Authorization:token}});_deleteProduct=axios.delete(\"/api/products/\".concat(id),{headers:{Authorization:token}});_context.next=6;return destroyImg;case 6:_context.next=8;return _deleteProduct;case 8:setLoading(false);setCallback(!callback);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);alert(_context.t0.response.data.msg);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function deleteProduct(_x,_x2){return _ref.apply(this,arguments);};}();var checkAll=function checkAll(){products.forEach(function(product){product.checked=!isCheck;});setProducts(_toConsumableArray(products));setIsCheck(!isCheck);};var deleteAll=function deleteAll(){products.forEach(function(product){if(product.checked)deleteProduct(product._id,product.images.public_id);});};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Loading,{})});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Filters,{}),isAdmin&&/*#__PURE__*/_jsxs(\"div\",{className:\"delete-all\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Seleccionar Todos\"}),/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:isCheck,onChange:checkAll}),/*#__PURE__*/_jsx(\"button\",{onClick:deleteAll,children:\"Borrar Todos\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"products\",children:products.map(function(product){return/*#__PURE__*/_jsx(ProductItem,{product:product,isAdmin:isAdmin,deleteProduct:deleteProduct,handleCheck:handleCheck},product._id);})}),/*#__PURE__*/_jsx(LoadMore,{}),products.length===0&&/*#__PURE__*/_jsx(Loading,{})]});}export default Products;","map":{"version":3,"sources":["C:/Users/Fabian FF/Desktop/envio/sportShop/client/src/components/mainpages/products/Products.js"],"names":["React","useContext","useState","GlobalState","ProductItem","Loading","axios","Filters","LoadMore","defaults","withCredentials","Products","state","ProductsAPI","products","setProducts","UserAPI","isAdmin","token","callback","setCallback","loading","setLoading","isCheck","setIsCheck","handleCheck","id","forEach","product","_id","checked","deleteProduct","public_id","destroyImg","post","headers","Authorization","delete","alert","response","data","msg","checkAll","deleteAll","images","map","length"],"mappings":"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","sourcesContent":["import React,{useContext,useState} from 'react';\nimport {GlobalState} from '../../../GlobalState';\nimport ProductItem from '../utils/productItem/ProductItem';\nimport Loading from \"../utils/loading/Loading\"\nimport axios from 'axios';\nimport Filters from './Filters';\nimport LoadMore from './LoadMore'\n\naxios.defaults.withCredentials = true\n\nfunction Products() {\n\n  const state = useContext(GlobalState)\n  const [products, setProducts] = state.ProductsAPI.products\n  const [isAdmin] = state.UserAPI.isAdmin \n  const [token] = state.token\n  const [callback , setCallback] = state.ProductsAPI.callback\n  const [loading, setLoading] = useState(false)\n  const [isCheck, setIsCheck] = useState(false)\n\n  \n\n\n  const handleCheck = (id)=>{\n    products.forEach(product=>{\n      if(product._id === id) product.checked = !product.checked\n    })\n    setProducts([...products])\n  }\n\n  const deleteProduct = async (id,public_id) =>{\n\n    try {\n      setLoading(true)\n      const destroyImg =  axios.post(\"/api/destroy\",{public_id},{\n        headers: {Authorization: token}\n      })\n      const deleteProduct =  axios.delete(`/api/products/${id}`,{\n        headers: {Authorization: token}\n      })\n     \n      await destroyImg\n      await deleteProduct\n      setLoading(false)\n      setCallback(!callback)\n\n    } catch (err) {\n        alert(err.response.data.msg)\n    }\n  }\n\n   const checkAll = () =>{\n    products.forEach(product =>{\n      product.checked = !isCheck\n    })\n    setProducts([...products])\n    setIsCheck(!isCheck)\n  }\n\n  const deleteAll = () =>{\n    products.forEach(product =>{\n      if(product.checked) deleteProduct(product._id, product.images.public_id)\n    })\n  }\n\n\n  if(loading) return  <div><Loading/></div>\n\n\n  return (\n    <>\n    <Filters/>\n\n    {\n      isAdmin && \n      <div className='delete-all'>\n        <span>Seleccionar Todos</span>\n        <input type=\"checkbox\" checked={isCheck} onChange={checkAll} />\n        <button onClick={deleteAll}>Borrar Todos</button>\n\n      </div>\n    }\n    <div className='products' >\n        {\n          products.map(product =>{\n            return <ProductItem key={product._id} product={product} \n            isAdmin={isAdmin} deleteProduct={deleteProduct} handleCheck={handleCheck}\n            />\n          })\n        }\n    </div>\n\n      <LoadMore/>\n      \n      {products.length === 0 && <Loading/>} \n    </>\n  );\n}\n\nexport default Products;\n"]},"metadata":{},"sourceType":"module"}